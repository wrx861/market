# üîç –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ Autotrade

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–∏—Å–∫–µ –∞—Ä—Ç–∏–∫—É–ª–∞ `A2761800009`:
- ‚ùå –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –∞–Ω–∞–ª–æ–≥ `ST-A2761800009`
- ‚úÖ –ù–æ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ `ST-A2761800009` –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –æ–±–∞

## –ü—Ä–∏—á–∏–Ω–∞

–†–∞–Ω—å—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **—Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π** –ø–æ–∏—Å–∫:
```python
strict=True    # –¢–æ–ª—å–∫–æ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
cross=False    # –ë–µ–∑ –∞–Ω–∞–ª–æ–≥–æ–≤
```

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É —á—Ç–æ:
- `A2761800009` –Ω–∞—Ö–æ–¥–∏–ª —Ç–æ–ª—å–∫–æ `A2761800009`
- `ST-A2761800009` –Ω–µ —Å—á–∏—Ç–∞–ª—Å—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º

## –†–µ—à–µ–Ω–∏–µ

### 1. –í–∫–ª—é—á–µ–Ω –ø–æ–∏—Å–∫ –ø–æ –∞–Ω–∞–ª–æ–≥–∞–º (cross)

```python
cross=True     # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏ –∏ –∫—Ä–æ—Å—Å—ã
strict=False   # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
replace=False  # –ó–∞–º–µ–Ω—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã (–æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã)
```

### 2. –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞

–í–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—É–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**:

#### –®–∞–≥ 1: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
```python
search_article = "A2761800009"
search_normalized = "A2761800009"  # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã, UPPER

item_article = "ST-A2761800009"
item_normalized = "STA2761800009"
```

#### –®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ "—è–¥—Ä–∞" –∞—Ä—Ç–∏–∫—É–ª–∞
```python
# –£–±–∏—Ä–∞–µ–º –æ–±—â–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
search_core = "A2761800009"  # –£–±—Ä–∞–ª–∏ ST, OE, OEM
item_core = "A2761800009"    # –£–±—Ä–∞–ª–∏ ST, OE, OEM
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
if search_core in item_core or item_core in search_core:
    ‚úÖ –ü–û–î–•–û–î–ò–¢
else:
    ‚ùå –ü–†–û–ü–£–°–ö–ê–ï–ú
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–∏—Å–∫ –±–∞–∑–æ–≤–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞

**–ü–æ–∏—Å–∫:** `A2761800009`

**–ù–∞–π–¥–µ—Ç:**
- ‚úÖ `A2761800009` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- ‚úÖ `ST-A2761800009` - –∞–Ω–∞–ª–æ–≥ (—É–±—Ä–∞–ª–∏ ST, —Å–æ–≤–ø–∞–ª–æ —è–¥—Ä–æ)
- ‚úÖ `A276 1800 009` - —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (—É–±—Ä–∞–ª–∏ –ø—Ä–æ–±–µ–ª—ã)
- ‚úÖ `OE-A2761800009` - –∞–Ω–∞–ª–æ–≥ (—É–±—Ä–∞–ª–∏ OE, —Å–æ–≤–ø–∞–ª–æ —è–¥—Ä–æ)

**–ù–µ –Ω–∞–π–¥–µ—Ç:**
- ‚ùå `A2761800010` - –¥—Ä—É–≥–∞—è —Ü–∏—Ñ—Ä–∞
- ‚ùå `B2761800009` - –¥—Ä—É–≥–∞—è –±—É–∫–≤–∞
- ‚ùå `12345` - —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–æ–π –∞—Ä—Ç–∏–∫—É–ª

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º

**–ü–æ–∏—Å–∫:** `ST-A2761800009`

**–ù–∞–π–¥–µ—Ç:**
- ‚úÖ `ST-A2761800009` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- ‚úÖ `A2761800009` - –±–∞–∑–æ–≤—ã–π –∞—Ä—Ç–∏–∫—É–ª (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞)
- ‚úÖ `STA2761800009` - –±–µ–∑ –¥–µ—Ñ–∏—Å–∞
- ‚úÖ `OE-A2761800009` - –∞–Ω–∞–ª–æ–≥ —Å –¥—Ä—É–≥–∏–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º

**–ù–µ –Ω–∞–π–¥–µ—Ç:**
- ‚ùå `ST-A2761800010` - –¥—Ä—É–≥–∞—è —Ü–∏—Ñ—Ä–∞
- ‚ùå `ST-B2761800009` - –¥—Ä—É–≥–∞—è –±—É–∫–≤–∞

### –ü—Ä–∏–º–µ—Ä 3: –ö–æ—Ä–æ—Ç–∫–∏–π –∞—Ä—Ç–∏–∫—É–ª

**–ü–æ–∏—Å–∫:** `123`

**–õ–æ–≥–∏–∫–∞:** –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤ (< 5 —Å–∏–º–≤–æ–ª–æ–≤) —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—è–≥—á–µ

**–ù–∞–π–¥–µ—Ç:**
- ‚úÖ `123` - —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- ‚úÖ `ST-123` - —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º
- ‚úÖ –ú–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ `12345` - —Å–æ–¥–µ—Ä–∂–∏—Ç "123"

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API Autotrade

```python
params = {
    "q": article,           # –ê—Ä—Ç–∏–∫—É–ª –¥–ª—è –ø–æ–∏—Å–∫–∞
    "strict": 0,            # 0 = —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (—Å –∞–Ω–∞–ª–æ–≥–∞–º–∏)
    "cross": 1,             # 1 = –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä–æ—Å—Å—ã –∏ –∞–Ω–∞–ª–æ–≥–∏
    "replace": 0,           # 0 = –∑–∞–º–µ–Ω—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã
    "with_stocks_and_prices": 1,
    "with_delivery": 1
}
```

### –ü—Ä–æ—Ü–µ—Å—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```python
for item in items:
    # 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    item_normalized = item_article.upper().replace(' ', '').replace('-', '')
    search_normalized = article.upper().replace(' ', '').replace('-', '')
    
    # 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —è–¥—Ä–∞
    search_core = search_normalized.lstrip('ST').lstrip('OE').lstrip('OEM')
    item_core = item_normalized.lstrip('ST').lstrip('OE').lstrip('OEM')
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –¥–ª–∏–Ω–∞ >= 5)
    if len(search_core) >= 5 and len(item_core) >= 5:
        if not (search_core in item_core or item_core in search_core):
            if not (search_normalized in item_normalized or item_normalized in search_normalized):
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                continue
    
    # 4. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    parts.append(item)
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∞–Ω–∞–ª–æ–≥–∏
- `A2761800009` ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç `ST-A2761800009`
- `ST-A2761800009` ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç `A2761800009`

### ‚úÖ –£–±–∏—Ä–∞–µ—Ç –º—É—Å–æ—Ä
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞—Ä—Ç–∏–∫—É–ª—ã —Å –¥—Ä—É–≥–∏–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞—Ä—Ç–∏–∫—É–ª—ã —Å –¥—Ä—É–≥–∏–º–∏ –±—É–∫–≤–∞–º–∏
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–≤—Å–µ–º –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –¥–µ—Ñ–∏—Å–∞–º–∏: `A-123-456` = `A123456`
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–±–µ–ª–∞–º–∏: `A 123 456` = `A123456`
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏: `ST-`, `OE-`, `OEM-`

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ù–µ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã
- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–æ–∫

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
logger.info(f"Searching Autotrade for article: {article}, strict=False, cross=True")
logger.debug(f"Skipping unrelated item: {item_article} (searching for {article})")
logger.info(f"Formatted {len(parts)} parts from Autotrade (after filtering)")
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
docker-compose logs backend | grep "Searching Autotrade"
docker-compose logs backend | grep "Skipping unrelated"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π –∞—Ä—Ç–∏–∫—É–ª
```bash
curl https://miniapp.shopmarketbot.ru/api/search/article?q=A2761800009
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏ A2761800009, –∏ ST-A2761800009
```

### –¢–µ—Å—Ç 2: –° –ø—Ä–µ—Ñ–∏–∫—Å–æ–º
```bash
curl https://miniapp.shopmarketbot.ru/api/search/article?q=ST-A2761800009
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏ ST-A2761800009, –∏ A2761800009
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```bash
curl https://miniapp.shopmarketbot.ru/api/search/article?q=A2761800009
# –ù–ï –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å A2761800010 –∏–ª–∏ B2761800009
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `backend/autotrade_client.py`:

```python
def search_by_article(
    self,
    article: str,
    cross: bool = True,      # –ê–Ω–∞–ª–æ–≥–∏: True/False
    replace: bool = False,   # –ó–∞–º–µ–Ω—ã: True/False
    strict: bool = False,    # –°—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫: True/False
    ...
):
```

---

**–í–µ—Ä—Å–∏—è:** 2.3  
**–î–∞—Ç–∞:** 2025-11-14  
**–§–∞–π–ª:** `backend/autotrade_client.py`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
